<!DOCTYPE html>
<html>

<head>
    <title>ESP WiFi Configuration</title>
    <script type="text/javascript">
        function redirect() {
            // Check if the hostname is an IP address (IPv4)
            var isIpAddress = /^(\d{1,3}\.){3}\d{1,3}$/.test(window.location.hostname);

            // Check if the hostname is 'localhost'
            var isLocalhost = window.location.hostname === 'localhost';

            // Only redirect if the hostname does not include 'esp32.local', it is not an IP address, and it is not 'localhost'
            if (!window.location.hostname.includes('esp32.local') && !isIpAddress && !isLocalhost) {
                window.location.href = 'http://esp32.local';
            }
        }

            function setupForm() {
                var form = document.querySelector('form');
                form.onsubmit = function (e) {
                    e.preventDefault(); // Prevent the form from submitting normally

                    // Convert FormData into URL-encoded string
                    var formData = new FormData(form);
                    var urlEncodedData = new URLSearchParams(formData).toString();

                    // Use fetch API to send the form data as URL-encoded
                    fetch('/api/v1/SetAPCred', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/x-www-form-urlencoded'  // This header tells the server how to parse the body correctly
                        },
                        body: urlEncodedData
                    })
                        .then(response => {
                            if (response.ok) {
                                return response.text();  // Process the text response
                            }
                            throw new Error('Network response was not ok.');
                        })
                        .then(data => {
                            document.getElementById('response').textContent = data; // Display the server response
                        })
                        .catch(error => {
                            document.getElementById('response').textContent = 'Error: ' + error.message;  // Display error messages
                        });
                };
            }

        window.onload = function () {
            redirect();  // Call the redirect function
            setupForm(); // Set up the form submission handling
        };

    </script>
</head>

<body>
    <h1>Configure WiFi</h1>
    <form>
        <label for="ssid">SSID:</label><br>
        <input type="text" id="ssid" name="ssid" required><br><br>
        <label for="password">Password:</label><br>
        <input type="password" id="password" name="password" required><br><br>
        <input type="submit" value="Submit">
    </form>
    <div id="response"></div> <!-- Place to display the response message -->
</body>

</html>