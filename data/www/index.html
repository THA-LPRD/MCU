<!DOCTYPE html>
<html>

<head>
    <title>ESP WiFi Configuration</title>
    <script type="text/javascript">
        function redirect() {
            // Check if the hostname is an IP address (IPv4)
            var isIpAddress = /^(\d{1,3}\.){3}\d{1,3}$/.test(window.location.hostname);

            // Only redirect if the hostname does not include 'esp32.local' and it is not an IP address
            if (!window.location.hostname.includes('esp32.local') && !isIpAddress) {
                window.location.href = 'http://esp32.local';
            }
        }

        function setupForm() {
            var form = document.querySelector('form');
            form.onsubmit = function (e) {
                e.preventDefault(); // Prevent the form from submitting normally

                var formData = new FormData(form); // Gather form data

                // Use fetch API to send the form data
                fetch('/api/SetAPCred', {
                    method: 'POST',
                    body: formData
                })
                    .then(response => {
                        if (response.ok) {
                            return response.text(); // Process the text response
                        }
                        throw new Error('Network response was not ok.');
                    })
                    .then(data => {
                        document.getElementById('response').textContent = data; // Display the server response
                    })
                    .catch(error => {
                        document.getElementById('response').textContent = 'Error: ' + error.message; // Display error messages
                    });
            };
        }

        window.onload = function () {
            redirect();  // Call the redirect function
            setupForm(); // Set up the form submission handling
        };

    </script>
</head>

<body>
    <h1>Configure WiFi</h1>
    <form>
        <label for="ssid">SSID:</label><br>
        <input type="text" id="ssid" name="ssid" required><br><br>
        <label for="password">Password:</label><br>
        <input type="password" id="password" name="password" required><br><br>
        <input type="submit" value="Submit">
    </form>
    <div id="response"></div> <!-- Place to display the response message -->
</body>

</html>