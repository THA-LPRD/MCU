<!DOCTYPE html>
<html>

<head>
    <title>ESP WiFi Configuration</title>
    <script type="text/javascript">
        function redirect() {
            var isIpAddress = /^(\d{1,3}\.){3}\d{1,3}$/.test(window.location.hostname);
            if (!window.location.hostname.includes('esp32.local') && !isIpAddress) {
                window.location.href = 'http://esp32.local';
            }
        }

        function setupForm() {
            var form = document.querySelector('form');
            form.onsubmit = function (e) {
                e.preventDefault();

                var formData = new FormData(form);
                fetch('/api/v1/SetOpMode', {
                    method: 'POST',
                    body: formData
                })
                    .then(response => {
                        if (response.ok) {
                            return response.text();
                        }
                        throw new Error('Network response was not ok.');
                    })
                    .then(data => {
                        document.getElementById('response').textContent = data;
                    })
                    .catch(error => {
                        document.getElementById('response').textContent = 'Error: ' + error.message;
                    });
            };
        }

        window.onload = function () {
            redirect();
            setupForm();
        };

    </script>
</head>

<body>
    <h1>Configure WiFi</h1>
    <form>
        <label for="opmode">Operating Mode:</label><br>
        <select id="opmode" name="opmode" required>
            <option value="Standalone">Standalone</option>
            <option value="Network">Network</option>
            <option value="Server">Server</option>
        </select><br><br>
        <input type="submit" value="Submit">
    </form>
    <div id="response"></div>
</body>

</html>
