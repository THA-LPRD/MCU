<!doctype html>

<html>

<head>
    <meta charset="utf-8">
    <meta name="LPRD" content="Einstellungen">
    <link rel="stylesheet" type="text/css" href="style.css">
    <script src="utils.js"></script>
    <script type="text/javascript">
        window.onload = function () {
            SetupSetWiFiCredForm();
            GetOpMode();
            GetDisplayModule();
        };

        async function GetOpMode() {
            try {
                let response = await fetch('/api/v1/GetOpMode');
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                let data = await response.text()
                document.getElementById('operatingMode').textContent = data;
            } catch (error) {
                console.error('Error fetching operating mode:', error);
                document.getElementById('responseMode').textContent = 'Fehler beim Abrufen des verwendeten Modus: ' + error.message;
            }
        }

        async function GetDisplayModule() {
            try {
                let response = await fetch('/api/v1/GetDisplayModule');
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                let data = await response.text();
                if (data === 'WS_7IN3G') {
                    document.getElementById('displayModule').textContent = 'Waveshare 7.3" 4 color';
                } else if (data === 'WS_9IN7') {
                    document.getElementById('displayModule').textContent = 'Waveshare 9.7" 2 color';
                } else {
                    document.getElementById('displayModule').textContent = 'Unknown';
                }
            } catch (error) {
                console.error('Error fetching display module:', error);
                document.getElementById('responseModule').textContent = 'Fehler beim Abrufen des verwendeten Displays: ' + error.message;
            }
        }

        function SetupSetWiFiCredForm() {
            const form = document.getElementById('SetWiFiCred-form');
            form.querySelector('#ssid').addEventListener('keypress', function (e) {
                if (e.key === 'Enter') {
                    form.querySelector('#password').focus();
                }
            });
            form.querySelector('#password').addEventListener('keypress', function (e) {
                if (e.key === 'Enter') {
                    SetWiFiCred();
                }
            });
        }

        async function SetOpMode() {
            const form = document.getElementById('SetOpMode-form');
            const opmode = form.querySelector('#opmode').value;
            const response = await SubmitFormData('/api/v1/SetOpMode', {opmode});
            const responseElement = document.getElementById('SetOpMode-response');
            if (responseElement) {
                responseElement.innerText = response;
            } else {
                console.error('Response element for SetOpMode not found.');
            }
        }

        async function SetDisplayModule() {
            const form = document.getElementById('SetDisplayModule-form');
            const displayModule = form.querySelector('#displayModule').value;
            const response = await SubmitFormData('/api/v1/SetDisplayModule', {displayModule});
            const responseElement = document.getElementById('SetDisplayModule-response');
            if (responseElement) {
                responseElement.innerText = response;
            } else {
                console.error('Response element for SetDisplayModule not found.');
            }
        }

        async function SetWiFiCred() {
            const form = document.getElementById('SetWiFiCred-form');
            const ssid = form.querySelector('#ssid').value;
            const password = form.querySelector('#password').value;
            const response = await SubmitFormData('/api/v1/SetWiFiCred', {ssid, password});
            const responseElement = document.getElementById('SetWiFiCred-response');
            if (responseElement) {
                responseElement.innerText = response;
            }
            else {
                console.error('Response element for SetWiFiCred not found.');
            }
        }

        async function restart() {
             try {
             const response = await fetch('/api/v1/restart', {
             method: 'POST'
             });

             if (!response.ok) {
             throw new Error('Network response was not ok');
             }

             return 'Neustart erfolgreich!';
             } catch (error) {
             console.error('Error during restart:', error);
             return 'Neustart fehlgeschlagen.';
             }
         }



    </script>

    <style>
        main {
            padding-bottom: 50px;
        }

        h2 {
            margin-bottom: 50px;
        }


        #responseModule, #responseMode, #responseWiFi {
                color:#FF0350;
                font-style: bold;
                font-style: italic;
                margin-left: 20px;
                margin-right: 20px;
            }

        #home {
            text-align: left;
            margin-left: 20px;
        }

        #restart {
            float: right;
            margin-right: 20px;

        }

    </style>
</head>

<body>

    <header>
        <div id="settings"><a href="./settings.html"><img src="./icons8-settings-25-w.png"></a></div>
        <img src="LPRD-Logo.webp" alt="Logo">
        <h1> Low-Power-Raumanzeige</h1>
    </header>

    <div class="container">
        <nav>
            <ul>
            </ul>
        </nav>

        <div id="restart">
            <button onclick="restart()">Restart</button>
        </div>
        
        <a id="home" href="./index.html">Zurück</a>

        <br>
        

        <main>
            <h2><u>Einstellungen</u></h2>
            <table>
                <tr>
                    <td>
                        <h3>1. Display-Modus:</h3>
                        <div id="responseMode"></div>
                        <p class="text">Sie befinden sich im: <span id="operatingMode"></span>-Modus</p>
                        <div id="SetOpMode-form">
                            <select id="opmode" name="opmode" required>
                                <option value="Standalone">Standalone-Modus</option>
                                <option value="Network">Netzwerk-Modus</option>
                                <option value="Server">Server</option>
                            </select>
                            <button onclick="SetOpMode()">Speichern</button>
                            <div id="SetOpMode-response"></div>
                        </div>
                    </td>
                    <td>
                        <h3>2. Display-Modul:</h3>
                        <div id="responseModule"></div>
                        <p class="text">Sie sind verbunden mit dem Display-Modul: <span id="displayModule"></span></p>
                        <div id="SetDisplayModule-form">
                            <select id="displayModule" name="displayModule" required>
                                <option value="WS_7IN3G">Waveshare 7.3" 4 color</option>
                                <option value="WS_9IN7">Waveshare 9.7" 2 color</option>
                            </select>
                            <button onclick="SetDisplayModule()">Speichern</button>
                            <div id="SetDisplayModule-response"></div>
                        </div>
                    </td>
                </tr>
                <tr>
                    <td>
                        <h3>3. WiFi Konfiguration:</h3>
                        <div id="responseWiFi"></div>
                        <div id="SetWiFiCred-form">
                            <form>
                                <label for="ssid">SSID:</label><br>
                                <input type="text" id="ssid" name="ssid" required><br><br>
                                <label for="password">Passwort:</label><br>
                                <input type="password" id="password" name="password" required><br><br>
                            </form>
                            <button onclick="SetWiFiCred()">Speichern</button>
                            <p id="SetWiFiCred-response"></p>
                        </div>
                    </td>
                </tr>
            </table>
        </main>
        
    </div>

    <footer>
        <p>© Projektarbeit Low-Power-Raumanzeige LPRD SoSe24</p>
        <p id="icons8"><a target="_blank" href="https://icons8.com/icon/2969/settings">Settings</a> icon by <a
                target="_blank" href="https://icons8.com">Icons8</a></p>
    </footer>
</body>

</html>